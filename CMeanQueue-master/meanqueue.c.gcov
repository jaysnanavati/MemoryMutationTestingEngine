        -:    0:Source:meanqueue.c
        -:    0:Programs:3
        -:    1:/*
        -:    2: 
        -:    3:Copyright (c) 2011, Willem-Hendrik Thiart
        -:    4:All rights reserved.
        -:    5:
        -:    6:Redistribution and use in source and binary forms, with or without
        -:    7:modification, are permitted provided that the following conditions are met:
        -:    8:    * Redistributions of source code must retain the above copyright
        -:    9:      notice, this list of conditions and the following disclaimer.
        -:   10:    * Redistributions in binary form must reproduce the above copyright
        -:   11:      notice, this list of conditions and the following disclaimer in the
        -:   12:      documentation and/or other materials provided with the distribution.
        -:   13:    * The names of its contributors may not be used to endorse or promote
        -:   14:      products derived from this software without specific prior written
        -:   15:      permission.
        -:   16:
        -:   17:THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
        -:   18:ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
        -:   19:WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
        -:   20:DISCLAIMED. IN NO EVENT SHALL WILLEM-HENDRIK THIART BE LIABLE FOR ANY
        -:   21:DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
        -:   22:(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
        -:   23:LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
        -:   24:ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
        -:   25:(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
        -:   26:SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
        -:   27:
        -:   28:*/
        -:   29:
        -:   30:#include <stdio.h>
        -:   31:#include <stdlib.h>
        -:   32:#include <strings.h>
        -:   33:#include <string.h>
        -:   34:#include <assert.h>
        -:   35:
        -:   36:#include "meanqueue.h"
        -:   37:
        4:   38:void *meanqueue_new(
        -:   39:    const int size
        -:   40:)
        -:   41:{
        -:   42:    meanqueue_t *qu;
        -:   43:
        4:   44:    qu = calloc(1, sizeof(meanqueue_t));
        4:   45:    qu->vals = calloc(size, sizeof(int));
        4:   46:    qu->size = size;
        4:   47:    return qu;
        -:   48:}
        -:   49:
        4:   50:void meanqueue_free(
        -:   51:    meanqueue_t * qu
        -:   52:)
        -:   53:{
        4:   54:    free(qu->vals);
        4:   55:    free(qu);
        4:   56:}
        -:   57:
       12:   58:void meanqueue_offer(
        -:   59:    meanqueue_t * qu,
        -:   60:    const int val
        -:   61:)
        -:   62:{
       12:   63:    qu->valSum += val;
       12:   64:    qu->valSum -= qu->vals[qu->idxCur];
       12:   65:    qu->vals[qu->idxCur] = val;
       12:   66:    qu->idxCur++;
       12:   67:    qu->mean = (float) qu->valSum / qu->size;
       12:   68:    if (qu->idxCur >= qu->size)
        2:   69:        qu->idxCur = 0;
       12:   70:}
        -:   71:
        4:   72:float meanqueue_get_value(
        -:   73:    meanqueue_t * qu
        -:   74:)
        -:   75:{
        4:   76:    return qu->mean;
        -:   77:}
